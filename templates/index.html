<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chatbot Demo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>üí¨ Chatbot Giao th√¥ng</h1>

        <!-- N√∫t t·∫°o chat m·ªõi -->
        <button id="new-chat-btn" onclick="clearChat()">+ T·∫°o ƒëo·∫°n chat m·ªõi</button>

        <!-- N√∫t upload t√†i li·ªáu -->
        <form id="upload-form" enctype="multipart/form-data" method="POST" action="/upload">
            <input type="file" name="file" accept=".pdf,.doc,.docx,.txt">
            <button type="submit">üìé Upload t√†i li·ªáu</button>
        </form>

        <div id="chat-box"></div>

        <div class="input-area">
            <input type="text" id="user-input" placeholder="Nh·∫≠p tin nh·∫Øn..." onkeydown="handleKey(event)">
            <button onclick="sendMessage()">G·ª≠i</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            addMessage("bot", "Xin ch√†o, t√¥i l√† Chatbot h·ªó tr·ª£ v·ªÅ Giao th√¥ng H√† N·ªôi, t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?");
        };

        async function sendMessage() {
            const input = document.getElementById("user-input");
            const message = input.value.trim();
            if (!message) return;

            addMessage("user", message);
            input.value = "";

            const res = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });

            const data = await res.json();
            data.responses.forEach(text => {
                addMessage("bot", text);
            });
        }

        function handleKey(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        }

        function addMessage(sender, text) {
            const box = document.getElementById("chat-box");
            const message = document.createElement("div");
            message.className = `message ${sender}`;
            message.innerHTML = `<div class="message-content">${text}</div>`;
            box.appendChild(message);
            box.scrollTop = box.scrollHeight;
        }

        function clearChat() {
            const box = document.getElementById("chat-box");
            box.innerHTML = "";
            addMessage("bot", "Xin ch√†o, t√¥i l√† Chatbot h·ªó tr·ª£ v·ªÅ Giao th√¥ng H√† N·ªôi, t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?");
        }
    </script>
</body>
</html>